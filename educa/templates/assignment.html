{% extends "course_layout.html" %}
{% block course_content %}
{% if current_user.id == course.teacher_id %}
  <!-- MODAL DELETE ASSIGNMENT -->
  <div id="delete_modal" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="ml-3">Delete Assignment</h2>
          <button type="button" class="close" data-dismiss="modal">
            <span>&times;</span>
          </button>
        </div>
        <form class="form-group" action="" method="POST">
          <div class="modal-body d-flex justify-content-center align-items-center m-0">
            <p class="mx-2">Are you sure you wish to delete this assignment?</p>
            <button class="btn btn-outline-danger mb-0" type="submit" name="delete" value="true">Yes</button>
            <button class="mx-1 btn btn-outline-warning mb-0" type="button" data-dismiss="modal">No</button>
          </div>
        </form>
      </div>
    </div>
  </div>
{% endif %}
  <div class="course-content">
    <div class="assignment-title">
      <h3>{{ assignment.title }}</h3>
    </div>
    <div class="assignment-info">
      <h5>Due: {{ assignment.duedate_ctime }}</h5>
      <h5 class="ml-1">Points: {{ assignment.points }}</h5>
      <h5 class="ml-1">Questions: {{ questions| length }}</h5>
    </div>
    <div class="assignment-instructions">
      <h5>Instructions:</h5>
      <p>{{ assignment.content| safe }}</p>
    </div>

    {% if not user_assignment and assignment.type != "Instructions" %}
      <form id="questions" class="form-group" action="{{ url_for('assignment', course_id=course.id, assignment_id=assignment.id) }}" method="POST">
        {% for i in range(questions| length) %}
          <div class="questions">
            <div class="card">
              <div class="card-header">
                <div class="d-flex justify-content-between align-items-center">
                  <h4>{{ questions[i].title }}</h4>
                  {% if questions[i].points > 1 %}
                    <h5>{{ questions[i].points }} Points</h5>
                  {% else %}
                    <h5>{{ questions[i].points }} Point</h5>
                  {% endif %}
                </div>
              </div>
              <div class="card-body">
                <h5 class="card-title">{{ questions[i].content| safe }}</h5>
                {% if questions[i].type == "multiple_choice" %}
                  <div id="question_{{ i }}">
                    {% for x in range(options_dict[questions[i].title]| length) %}
                      <div class="options">
                        <input id="question_{{ i }}_{{ x }}" type="radio" name="question_{{ i }}" value="{{ options_dict[questions[i].title][x].content }}">
                        <label for="question_{{ i }}_{{ x }}">{{ options_dict[questions[i].title][x].content }}</label>
                      </div>
                    {% endfor %}
                  </div>
                  <div class="invalid-feedback">
                    <small id="question_{{ i }}_error"></small>
                  </div>
                {% elif questions[i].type == "input" %}
                  <input id="question_{{ i }}" class="form-control" type="text" name="question_{{ i }}" placeholder="Type your answer here">
                  <div class="invalid-feedback">
                    <small id="question_{{ i }}_error"></small>
                  </div>
                {% else %}
                  <textarea id="question_{{ i }}" class="form-control" name="question_{{ i }}" rows="8" cols="80" placeholder="Type your answer here"></textarea>
                  <div class="invalid-feedback">
                    <small id="question_{{ i }}_error"></small>
                  </div>
                {% endif %}
              </div>
            </div>
          </div>
        {% endfor %}
        {% if current_user.profession == "Student" %}
          <div class="d-flex justify-content-center">
              <button class="btn btn-outline-primary" type="submit">Submit</button>
          </div>
        {% endif %}
      </form>
    {% else %}
      {% if assignment.type != "Instructions" %}
        <div class="d-flex justify-content-center align-items-center">
          <h5>You scored {{ user_assignment.points }}/{{ assignment.points }}!</h5>
        </div>
        <!-- <div class="d-flex flex-column align-items-center">
          <p>The assignment with the best score will be submitted.</p>
          <form class="form-group" action="" method="GET">
            <button class="btn btn-primary my-2" type="submit" name="redo" value="true">Redo Assignment</button>
          </form>
        </div> -->
      {% endif %}
    {% endif %}
    {% if current_user.id == course.teacher_id %}
    <div class="d-flex justify-content-center">
      <button class="btn btn-outline-danger mx-2 mb-5" type="button" data-toggle="modal" data-target="#delete_modal">Delete Assignment</button>
    </div>
    {% endif %}
  </div>
  <script type="text/javascript" src="{{ url_for('static', filename='js/assignment.js')|autoversion }}"></script>
{% endblock course_content %}
